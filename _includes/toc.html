<!-- On-page Table of Contents -->
<aside class="docs-toc" aria-label="On this page">
  <div class="toc-container">
    <h4 class="toc-title">On this page</h4>
    <nav id="toc-nav">
      <!-- TOC will be generated by JavaScript -->
    </nav>
  </div>
</aside>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tocNav = document.getElementById('toc-nav');
  const article = document.querySelector('.docs-content');

  if (!tocNav || !article) return;

  // Find all headings h2 and h3 in the content
  const headings = article.querySelectorAll('h2, h3');

  if (headings.length === 0) {
    // Hide TOC if no headings
    document.querySelector('.docs-toc').style.display = 'none';
    return;
  }

  const tocList = document.createElement('ul');
  tocList.className = 'toc-list';

  headings.forEach(function(heading, index) {
    // Ensure heading has an ID
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    const li = document.createElement('li');
    li.className = heading.tagName.toLowerCase();

    const link = document.createElement('a');
    link.href = '#' + heading.id;
    link.textContent = heading.textContent;
    link.className = 'toc-link';

    li.appendChild(link);
    tocList.appendChild(li);
  });

  tocNav.appendChild(tocList);

  // ScrollSpy - highlight current section
  const tocLinks = tocNav.querySelectorAll('.toc-link');

  function updateActiveLink() {
    let current = '';
    const scrollPos = window.scrollY + 100;

    headings.forEach(function(heading) {
      if (heading.offsetTop <= scrollPos) {
        current = heading.id;
      }
    });

    tocLinks.forEach(function(link) {
      link.classList.remove('active');
      if (link.getAttribute('href') === '#' + current) {
        link.classList.add('active');
      }
    });
  }

  // Throttle scroll event
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        updateActiveLink();
        ticking = false;
      });
      ticking = true;
    }
  });

  // Initial update
  updateActiveLink();
});
</script>
